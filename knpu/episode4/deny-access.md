# Deny Access

Welcome back guys. This is now part four of our symphony restful series and this one is going to be really, really great because it’s on authentication and in particular we’re going to do something cool with JWT that’s Jason Web Token authentication. So I cannot wait to start doing that. Now, you should totally code along with me so that this all sinks in and you get really good at it. To do that, find the screencast page. Go to download. Go to code, unzip it and move it to the Start directory. I already have the Start directory code downloaded into this symphony dash rest directory. 

So I’m going to go ahead and start the built in – so I’m going to open a new tab. I’m going to start the built in web server with bin consul server colon run. Now you’ll also notice one other difference and that is that I’ve upgraded our project to symphony three. So if you’re following along with me from the previous tutorial, download the start codes so that you have the new fresh symphony three project. As a reminder, our app is called code battles. It has a cool web interface. You can log in with Weaver Ryan Foo. 

We’re going to create programmers and start battles and our goal has to be to create an API interface for that and so far we’ve actually done a really good job with that. Insider of our controller slash API directory, we have this great looking program or controller where we’re able to create programmers, get programmers, edit programmers and we have an awesome test suite in the test directory for all of these different endpoints. However, everything in our API is anonymous right now which means anybody can use our API to do anything and that is not what we intend. 

For example, to create a new programmer, you need to be logged into our system. That’s exactly how the web interface works. So as always, let’s start with a test. So we can think about what our API should return if a user tries to do something on the site and they’re not authenticated. So in programmer controller tasks, let’s create a new public function, test requires authentication and what we’ll do is we’ll just make an API call to an endpoint that we ultimately want to be secured. So response equals this arrow client. Hm. Response equals this arrow client arrow post slash API slash programmers. 

That’s the endpoint to create a new programmer and we’ll send a valid [inaudible] [00:03:57] body, but we’ll just send black [inaudible]. Eventually, we want this actually to fail. So we want to assert equals that the response status code is 401. Copy the method name and go to the terminal. Go back to the original tab. Let’s run vendor VIN PHP unit dash dash filter and that method name so we can try it out. Now right now it fails which we expect and it’s failing because there’s a validation error. So we see this is actually getting into our controller and it’s failing because it’s actually trying to process our data and we haven’t sent it a nickname. 

So obviously not passing which is fine because we don’t have any security yet. So in programmer controller, our first job is to require the user to be logged in. Now we’re not talking about the user is going to be authenticated yet because it doesn’t matter in your controller. Your job in your controller is just to say yes or no, I want to allow access. So let’s say this arrow deny access unless granted and then we’ll say role underscore user. Role underscore user is a role that in most authentication systems all users have. 

So this is a way for us to say you have to be logged in somehow. So now go back to our test. Try it again and interesting. It’s a 200 status code instead of a 401 and look closely here. It’s actually failed because it’s being redirected to the login page. You can see a summary of what our page looks like here. So in some ways it’s working because it is denying access, but our security system is not setup correctly yet to send back a response that’s proper for an API. So that’s what we need to work on and we’re going to [inaudible] web tokens to do it.
